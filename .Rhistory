rm(list=ls())
df<-read.xlsx("matched_young_used.xlsx")
# 安装并加载 openxlsx
install.packages("openxlsx")
library(openxlsx)
# 使用 read.xlsx 读取 Excel 文件
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
getwd()
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
View(data)
> data <- read.xlsx("matched_old_used.xlsx", sheet = 1)
data <- read.xlsx("matched_old_used.xlsx", sheet = 1)
View(data)
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
# 按生物年龄加速与否进行分组
df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
ifelse(df$phenoage_advance < 0, "decelerated", "same"))
class(df)
> # 按生物年龄加速与否进行分组
># 按生物年龄加速与否进行分组
# 按生物年龄加速与否进行分组df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
+                    ifelse(df$phenoage_advance < 0, "decelerated", "same"))
# 按生物年龄加速与否进行分组
df$group <- ifelse(df$BAA > 0, "accelerated",
ifelse(df$BAA < 0, "decelerated", "same"))
rm(df)  # 删除 df 对象
df$phenoage_advance
df <- data.frame(phenoage_advance = c(1.2, 2.5, 3.8))
View(df)
View(df)
df$phenoage_advance
View(df)
View(df)
# 按生物年龄加速与否进行分组
>df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
# 按生物年龄加速与否进行分组
df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
+                    ifelse(df$phenoage_advance < 0, "decelerated", "same"))
# 查看分组后的频次
table(df$group)
# 计算生物年龄加速 (PhenoAgeAccel)
df$PhenoAgeAccel <- df$phenoage - df$Age
View(df)
View(df)
rm(df)
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
library(openxlsx)
# 使用 read.xlsx 读取 Excel 文件
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
df$phenoage_advance
# 按生物年龄加速与否进行分组
df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
ifelse(df$phenoage_advance < 0, "decelerated", "same"))
colnames(data)  # 查看列名
df <- data$phenoage_advance  # 提取列 phenoage_advance 并赋值给 df
# 按生物年龄加速与否进行分组
df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
+                    ifelse(df$phenoage_advance < 0, "decelerated", "same"))
library(openxlsx)
# 读取 Excel 文件
data <- read.xlsx("matched_young_used.xlsx", sheet = 1)
# 检查是否正确加载为数据框
class(data)  # 输出应该是 "data.frame"
# 提取变量 phenoage_advance
df <- data$phenoage_advance  # 提取列为向量
# 如果你需要将其转为数据框
df <- data.frame(phenoage_advance = df)
# 检查提取结果
head(df)
# 按生物年龄加速与否进行分组
df$groupage <- ifelse(df$phenoage_advance > 0, "accelerated",
+                             +                    ifelse(df$phenoage_advance < 0, "decelerated", "same"))
library(openxlsx)
# 读取 Excel 文件
df <- read.xlsx("matched_young_used.xlsx", sheet = 1)
# 检查列类型
str(df)
# 转换 phenoage_advance 为数值类型（如果不是数值）
df$phenoage_advance <- as.numeric(as.character(df$phenoage_advance))
# 添加新列 status
df$status <- ifelse(df$phenoage_advance < 0, "decelerated", "same")
# 查看结果
head(df)
# 查看分组后的频次
table(df$status)
# 读取 Excel 文件
df <- read.xlsx("matched_young_used.xlsx", sheet = 1)
# 密度图
ggplot(df, aes(x = phenoage, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
library(ggplot2)
# 密度图
ggplot(df, aes(x = phenoage, fill = factor(group))) +
+     geom_density(alpha = 0.5) +
+     labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
+     scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
rlang::last_trace()
rlang::last_trace(drop = FALSE)
# 密度图
ggplot(df, aes(x = phenoage, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
# 密度图ggplot(df, aes(x = phenoage, fill = factor(group))) +
+   geom_density(alpha = 0.5) +
+   labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
+   scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
# 密度图
ggplot(df, aes(x = phenoage, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
scale_fill_discrete(name = "Lung Cancer", labels = c("Yes", "No"))
# 修改颜色映射
ggplot(df, aes(x = phenoage, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "Phenoage", y = "Density", title = "Distribution of Phenoage by Lung Cancer Status") +
scale_fill_manual(
name = "Lung Cancer",
labels = c("Yes", "No"),
values = c("blue", "red")  # 指定颜色顺序：第一个是 Yes，第二个是 No
)
# 修改颜色映射
ggplot(df, aes(x = phenoage_advance, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "PhenoAgeAccel", y = "Density", title = "Distribution of PhenoAgeAccel by Lung Cancer Status") +
scale_fill_manual(
name = "Lung Cancer",
labels = c("Yes", "No"),
values = c("blue", "red")  # 指定颜色顺序：第一个是 Yes，第二个是 No
)
ks.test(df$PhenoAgeAccel[df$group == "Yes"], df$phenoage[df$group == "No"])
# 检查分组数量
table(df$group)
# 确保列名正确
names(df)
# 检查是否有缺失值
sum(is.na(df$PhenoAgeAccel))
# 确保两组数据都不为空
yes_data <- df$PhenoAgeAccel[df$group == "Yes"]
no_data <- df$PhenoAgeAccel[df$group == "No"]
# 检查每组数据的长度
cat("Yes group length:", length(yes_data), "\n")
cat("No group length:", length(no_data), "\n")
# 确保数据足够后，执行 KS 检验
if (length(yes_data) > 1 & length(no_data) > 1) {
ks.test(yes_data, no_data)
} else {
cat("数据不足，无法进行 KS 检验。\n")
}
data <- read.xlsx("matched_old_used.xlsx", sheet = 1)
# 修改颜色映射
ggplot(df, aes(x = PhenoAgeAccel, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "PhenoAgeAccel", y = "Density", title = "Distribution of PhenoAgeAccel by Lung Cancer Status") +
scale_fill_manual(
name = "Lung Cancer",
labels = c("Yes", "No"),
values = c("blue", "red")  # 指定颜色顺序：第一个是 Yes，第二个是 No
)
# 修改颜色映射
ggplot(df, aes(x = phenoage_advance, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "PhenoAgeAccel", y = "Density", title = "Distribution of PhenoAgeAccel by Lung Cancer Status") +
scale_fill_manual(
name = "Lung Cancer",
labels = c("Yes", "No"),
values = c("blue", "red")  # 指定颜色顺序：第一个是 Yes，第二个是 No
)
View(df)
View(data)
View(data)
# 密度图
ggplot(df, aes(x = phenoage_advance, fill = factor(lung_cancer))) +
geom_density(alpha = 0.5) +
labs(x = "Biological Age", y = "Density", title = "Distribution of Biological Age by Lung Cancer Status") +
scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
# 密度图
ggplot(df, aes(x = phenoage_advance, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "Biological Age", y = "Density", title = "Distribution of Biological Age by Lung Cancer Status") +
scale_fill_discrete(name = "Lung Cancer", labels = c("No", "Yes"))
library(readxl)
df<-read.xlsx("matched_old_used", sheet = "Sheet1")
>library(readxl)
library(readxl)
df<-read.xlsx("matched_old_used", sheet = "Sheet1")
library(openxlsx)
df<-read.xlsx("matched_old_used", sheet = "Sheet1")
df<-read.xlsx("matched_old_used", sheet = "sheet1")
getwd()
df<-read.xlsx("matched_old_used")
df<-read.xlsx("matched_old_used", sheet = 1)
df<-read.xlsx("matched_old_used", sheet = 1)
df<-read.xlsx("matched_young_used", sheet = 1)
df<-read.xlsx("matched_old_used", sheet = "Sheet5")
df<-read.xlsx("matched_old_used", sheet = 1)
df<-read.xlsx("matched_old_used.xlsx", sheet = 1)
# 绘制密度图
library(ggplot2)
ggplot(df, aes(x = phenoage_advance, fill = factor(group))) +
geom_density(alpha = 0.5) +
labs(x = "PhenoAgeAccel", y = "Density", title = "Distribution of PhenoAgeAccel by Lung Cancer Status") +
scale_fill_manual(values = c("blue", "red"), name = "Lung Cancer", labels = c("Yes", "No")) +
theme_minimal()
# 检查分组数量
table(df$group)
# 确保列名正确
names(df)
# 检查是否有缺失值
sum(is.na(df$phenoage_advance))
# 确保两组数据都不为空
yes_data <- df$phenoage_advance[df$group == "Yes"]
no_data <- df$phenoage_advance[df$group == "No"]
# 检查每组数据的长度
cat("Yes group length:", length(yes_data), "\n")
cat("No group length:", length(no_data), "\n")
# 确保数据足够后，执行 KS 检验
if (length(yes_data) > 1 & length(no_data) > 1) {
ks.test(yes_data, no_data)
} else {
cat("数据不足，无法进行 KS 检验。\n")
}
# 检查分组数量
table(df$group)
# 确保列名正确
names(df)
ks.test(df$phenoage_advance[df$group == "case_old"], df$phenoage[df$group == "control_old"])
library(ggplot2)
# 创建累积分布数据框
case_data <- ecdf(df$phenoage_advance[df$group == "case_old"])
control_data <- ecdf(df$phenoage[df$group == "control_old"])
plot(case_data, col = "blue", lwd = 2, main = "CDF of Case vs Control", xlab = "Phenoage", ylab = "Cumulative Probability")
lines(control_data, col = "red", lwd = 2)
legend("bottomright", legend = c("Case", "Control"), col = c("blue", "red"), lwd = 2)
library(ggplot2)
# 创建累积分布数据框
case_data <- ecdf(df$phenoage_advance[df$group == "case_old"])
control_data <- ecdf(df$phenoage_advance[df$group == "control_old"])
plot(case_data, col = "blue", lwd = 2, main = "CDF of Case vs Control", xlab = "PhenoAgeAccel", ylab = "Cumulative Probability")
lines(control_data, col = "red", lwd = 2)
legend("bottomright", legend = c("Case", "Control"), col = c("blue", "red"), lwd = 2)
load("E:/肺癌的伟大征程/青年肺癌/临床文章篇/.RData")
